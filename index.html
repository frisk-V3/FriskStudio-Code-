<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>FriskStudio Code</title>
<style>
  * { box-sizing: border-box; }
  body {
    margin: 0;
    background: #0f0f14;
    color: #e5e5e5;
    font-family: "Segoe UI", system-ui, sans-serif;
  }

  /* ヘッダー */
  .header {
    padding: 14px 20px;
    font-size: 20px;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: white;
    box-shadow: 0 3px 10px #0008;
    background: linear-gradient(90deg, #4b6cff, #9a4bff);
  }
  body.light {
    background: #f5f5f5;
    color: #222;
  }
  body.light .header {
    box-shadow: 0 3px 10px #0003;
  }

  .theme-web    { background: linear-gradient(90deg, #4b6cff, #9a4bff); }
  .theme-style  { background: linear-gradient(90deg, #ff7f50, #ffb347); }
  .theme-script { background: linear-gradient(90deg, #ffcc4b, #ff9a4b); }
  .theme-c      { background: linear-gradient(90deg, #4bff7a, #2ecc71); }
  .theme-markup { background: linear-gradient(90deg, #ff4bd8, #ff6bb0); }
  .theme-system { background: linear-gradient(90deg, #7f7fff, #4b4bff); }

  /* 言語選択画面 */
  #language-screen {
    padding: 20px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 14px;
  }
  .lang-card {
    padding: 12px;
    border-radius: 10px;
    box-shadow: 0 0 10px #0006;
    cursor: pointer;
    border: 1px solid #2a2a33;
    color: #fff;
    font-size: 13px;
    transition: 0.18s;
  }
  .lang-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 16px #0009;
    border-color: #fff;
  }
  .lang-name {
    font-weight: 600;
    margin-bottom: 4px;
    font-size: 14px;
  }
  .cat-web    { background: radial-gradient(circle at top left, #4b6cff, #1a1a22); }
  .cat-style  { background: radial-gradient(circle at top left, #ff7f50, #1a1a22); }
  .cat-script { background: radial-gradient(circle at top left, #ffcc4b, #1a1a22); }
  .cat-c      { background: radial-gradient(circle at top left, #4bff7a, #1a1a22); }
  .cat-markup { background: radial-gradient(circle at top left, #ff4bd8, #1a1a22); }
  .cat-system { background: radial-gradient(circle at top left, #7f7fff, #1a1a22); }

  /* エディタ画面 */
  #editor-screen {
    height: calc(100vh - 52px);
    display: none;
    flex-direction: column;
  }
  .editor-top {
    padding: 8px 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #1a1a22;
    box-shadow: 0 3px 10px #0008;
    font-size: 14px;
  }
  .editor-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .back-btn {
    cursor: pointer;
    padding: 4px 10px;
    border-radius: 6px;
    background: #333;
  }
  .back-btn:hover { background: #555; }

  #editor-area {
    flex: 1;
    display: flex;
    min-height: 0;
  }
  #editor-container {
    flex: 1;
    min-width: 0;
  }
  #preview-pane {
    width: 40%;
    min-width: 260px;
    border-left: 3px solid #4b6cff;
    background: #ffffff;
    color: #000;
    box-shadow: inset 0 0 10px #0004;
  }
  #preview-frame {
    width: 100%;
    height: 100%;
    border: none;
  }

  .btn {
    padding: 6px 12px;
    border-radius: 6px;
    background: #3a3a3a;
    cursor: pointer;
    font-size: 13px;
    border: none;
    color: #eee;
  }
  .btn:hover { background: #505050; }

  /* 左下の設定ボタン */
  .settings-btn {
    position: fixed;
    bottom: 20px;
    left: 20px;
    width: 55px;
    height: 55px;
    background: #4b6cff;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 26px;
    cursor: pointer;
    box-shadow: 0 6px 20px #0008;
    transition: 0.25s;
    color: #fff;
    z-index: 20;
  }
  .settings-btn:hover { transform: scale(1.1); }

  /* 設定モーダル */
  .modal-backdrop {
    position: fixed;
    inset: 0;
    background: #0008;
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 30;
  }
  .modal {
    background: #1a1a22;
    padding: 18px;
    border-radius: 12px;
    width: 320px;
    box-shadow: 0 8px 25px #000c;
    font-size: 13px;
  }
  body.light .modal {
    background: #ffffff;
    color: #222;
  }
  .modal h2 {
    margin: 0 0 10px;
    font-size: 16px;
  }
  .modal-section {
    margin-bottom: 10px;
  }
  .switch-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 4px 0;
  }
  label { cursor: pointer; }
</style>

<!-- Monaco Editor CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.52.0/min/vs/loader.min.js"></script>
<script>
  window.monacoReady = false;
  window.monacoQueue = [];
  require.config({
    paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.52.0/min/vs' }
  });
  require(['vs/editor/editor.main'], function () {
    window.monacoReady = true;
    window.monacoQueue.forEach(fn => fn());
    window.monacoQueue = [];
  });
</script>
</head>
<body>

<div class="header theme-web" id="headerBar">
  <div>FriskStudio Code</div>
  <div style="font-size:12px;opacity:0.8;">言語を選んでスタート</div>
</div>

<!-- 言語選択 -->
<div id="language-screen">
  <!-- Web / Style / Script / C / Markup / System -->
  <div class="lang-card cat-web"    onclick="selectLanguage('html','web')"><div class="lang-name">HTML</div><div>プレビュー付き</div></div>
  <div class="lang-card cat-style"  onclick="selectLanguage('css','style')"><div class="lang-name">CSS</div><div>スタイルシート</div></div>
  <div class="lang-card cat-web"    onclick="selectLanguage('javascript','web')"><div class="lang-name">JavaScript</div><div>ブラウザスクリプト</div></div>
  <div class="lang-card cat-web"    onclick="selectLanguage('json','web')"><div class="lang-name">JSON</div><div>データ形式</div></div>

  <div class="lang-card cat-script" onclick="selectLanguage('python','script')"><div class="lang-name">Python</div></div>
  <div class="lang-card cat-script" onclick="selectLanguage('php','script')"><div class="lang-name">PHP</div></div>
  <div class="lang-card cat-script" onclick="selectLanguage('ruby','script')"><div class="lang-name">Ruby</div></div>
  <div class="lang-card cat-script" onclick="selectLanguage('perl','script')"><div class="lang-name">Perl</div></div>
  <div class="lang-card cat-script" onclick="selectLanguage('go','script')"><div class="lang-name">Go</div></div>
  <div class="lang-card cat-web"    onclick="selectLanguage('nodejs','web')"><div class="lang-name">Node.js</div></div>

  <div class="lang-card cat-c"      onclick="selectLanguage('c','c')"><div class="lang-name">C</div></div>
  <div class="lang-card cat-c"      onclick="selectLanguage('cpp','c')"><div class="lang-name">C++</div></div>
  <div class="lang-card cat-c"      onclick="selectLanguage('csharp','c')"><div class="lang-name">C#</div></div>
  <div class="lang-card cat-c"      onclick="selectLanguage('fsharp','c')"><div class="lang-name">F#</div></div>
  <div class="lang-card cat-c"      onclick="selectLanguage('rust','c')"><div class="lang-name">Rust</div></div>
  <div class="lang-card cat-c"      onclick="selectLanguage('objc','c')"><div class="lang-name">Objective‑C</div></div>
  <div class="lang-card cat-c"      onclick="selectLanguage('swift','c')"><div class="lang-name">Swift</div></div>

  <div class="lang-card cat-markup" onclick="selectLanguage('sql','markup')"><div class="lang-name">SQL</div></div>
  <div class="lang-card cat-markup" onclick="selectLanguage('xml','markup')"><div class="lang-name">XML</div></div>
  <div class="lang-card cat-markup" onclick="selectLanguage('markdown','markup')"><div class="lang-name">Markdown</div></div>
  <div class="lang-card cat-system" onclick="selectLanguage('powershell','system')"><div class="lang-name">PowerShell</div></div>
  <div class="lang-card cat-system" onclick="selectLanguage('batch','system')"><div class="lang-name">Batch</div></div>
  <div class="lang-card cat-system" onclick="selectLanguage('dockerfile','system')"><div class="lang-name">Dockerfile</div></div>
  <div class="lang-card cat-script" onclick="selectLanguage('java','script')"><div class="lang-name">Java</div></div>
</div>

<!-- エディタ画面 -->
<div id="editor-screen">
  <div class="editor-top" id="editorTopBar">
    <div class="editor-left">
      <div class="back-btn" onclick="goBack()">← 戻る</div>
      <div id="editor-title">Editor</div>
    </div>
    <div>
      <button class="btn" id="downloadBtn">DL</button>
    </div>
  </div>
  <div id="editor-area">
    <div id="editor-container"></div>
    <div id="preview-pane" style="display:none;">
      <iframe id="preview-frame"></iframe>
    </div>
  </div>
</div>

<!-- 左下設定ボタン -->
<div id="settingsBtn" class="settings-btn">⚙</div>

<!-- 設定モーダル -->
<div id="settingsModal" class="modal-backdrop">
  <div class="modal">
    <h2>設定</h2>

    <div class="modal-section">
      <strong>テーマ</strong>
      <div class="switch-row">
        <label for="themeDark">ダークモード</label>
        <input type="radio" name="theme" id="themeDark" value="dark" checked>
      </div>
      <div class="switch-row">
        <label for="themeLight">ホワイトモード</label>
        <input type="radio" name="theme" id="themeLight" value="light">
      </div>
    </div>

    <div class="modal-section">
      <strong>ファイル保存</strong>
      <div class="switch-row">
        <label for="overwriteToggle">読み込んだファイルを上書きする</label>
        <input type="checkbox" id="overwriteToggle" checked>
      </div>
    </div>

    <div class="modal-section">
      <strong>HTMLプレビュー</strong>
      <div class="switch-row">
        <label for="previewAuto">自動更新</label>
        <input type="radio" name="previewMode" id="previewAuto" value="auto" checked>
      </div>
      <div class="switch-row">
        <label for="previewManual">Ctrl+Sで更新</label>
        <input type="radio" name="previewMode" id="previewManual" value="manual">
      </div>
    </div>

    <div style="text-align:right;margin-top:8px;">
      <button class="btn" onclick="closeSettings()">閉じる</button>
    </div>
  </div>
</div>

<script>
let currentLang = null;
let currentGroup = 'web';
let editor = null;
let previewMode = 'auto';
let overwriteEnabled = true;
let currentTheme = 'dark';

const headerBar      = document.getElementById('headerBar');
const languageScreen = document.getElementById('language-screen');
const editorScreen   = document.getElementById('editor-screen');
const previewPane    = document.getElementById('preview-pane');
const previewFrame   = document.getElementById('preview-frame');
const editorTitle    = document.getElementById('editor-title');
const downloadBtn    = document.getElementById('downloadBtn');
const settingsBtn    = document.getElementById('settingsBtn');
const settingsModal  = document.getElementById('settingsModal');

function selectLanguage(lang, group) {
  currentLang = lang;
  currentGroup = group;
  applyHeaderTheme();
  showEditor();
}

function applyHeaderTheme() {
  headerBar.className = 'header';
  if (currentGroup === 'web')    headerBar.classList.add('theme-web');
  else if (currentGroup === 'style')  headerBar.classList.add('theme-style');
  else if (currentGroup === 'script') headerBar.classList.add('theme-script');
  else if (currentGroup === 'c')      headerBar.classList.add('theme-c');
  else if (currentGroup === 'markup') headerBar.classList.add('theme-markup');
  else if (currentGroup === 'system') headerBar.classList.add('theme-system');
}

function showEditor() {
  languageScreen.style.display = 'none';
  editorScreen.style.display   = 'flex';

  const isHtml = (currentLang === 'html');
  previewPane.style.display = isHtml ? 'block' : 'none';

  editorTitle.textContent = isHtml ? 'HTML Editor' : (displayName(currentLang) + ' Editor');
  downloadBtn.textContent = 'DL ' + getExtLabel(currentLang);

  initMonacoEditor();
}

function goBack() {
  editorScreen.style.display   = 'none';
  languageScreen.style.display = 'grid';
}

function initMonacoEditor() {
  const run = () => {
    const langId = mapLanguage(currentLang);
    const value  = getDefaultCode(currentLang);

    if (!editor) {
      editor = monaco.editor.create(document.getElementById('editor-container'), {
        value,
        language: langId,
        theme: currentTheme === 'dark' ? 'vs-dark' : 'vs',
        automaticLayout: true
      });

      editor.onDidChangeModelContent(() => {
        if (previewMode === 'auto' && currentLang === 'html') {
          updatePreview();
        }
      });

      editor.onKeyDown(e => {
        if (previewMode === 'manual' && currentLang === 'html' && e.ctrlKey && e.code === 'KeyS') {
          e.preventDefault();
          updatePreview();
        }
      });
    } else {
      monaco.editor.setModelLanguage(editor.getModel(), langId);
      editor.setValue(value);
      monaco.editor.setTheme(currentTheme === 'dark' ? 'vs-dark' : 'vs');
    }

    if (currentLang === 'html') updatePreview();
  };

  if (window.monacoReady) run();
  else window.monacoQueue.push(run);
}

function mapLanguage(lang) {
  const map = {
    html: 'html',
    css: 'css',
    javascript: 'javascript',
    json: 'json',
    python: 'python',
    php: 'php',
    ruby: 'ruby',
    perl: 'plaintext',
    go: 'go',
    nodejs: 'javascript',
    c: 'c',
    cpp: 'cpp',
    csharp: 'csharp',
    fsharp: 'fsharp',
    rust: 'rust',
    objc: 'objective-c',
    swift: 'swift',
    sql: 'sql',
    xml: 'xml',
    markdown: 'markdown',
    powershell: 'powershell',
    batch: 'bat',
    dockerfile: 'dockerfile',
    java: 'java'
  };
  return map[lang] || 'plaintext';
}

function displayName(lang) {
  const map = {
    html: 'HTML',
    css: 'CSS',
    javascript: 'JavaScript',
    json: 'JSON',
    python: 'Python',
    php: 'PHP',
    ruby: 'Ruby',
    perl: 'Perl',
    go: 'Go',
    nodejs: 'Node.js',
    c: 'C',
    cpp: 'C++',
    csharp: 'C#',
    fsharp: 'F#',
    rust: 'Rust',
    objc: 'Objective‑C',
    swift: 'Swift',
    sql: 'SQL',
    xml: 'XML',
    markdown: 'Markdown',
    powershell: 'PowerShell',
    batch: 'Batch',
    dockerfile: 'Dockerfile',
    java: 'Java'
  };
  return map[lang] || lang;
}

function getExtLabel(lang) {
  const map = {
    html: '.html',
    css: '.css',
    javascript: '.js',
    json: '.json',
    python: '.py',
    php: '.php',
    ruby: '.rb',
    perl: '.pl',
    go: '.go',
    nodejs: '.js',
    c: '.c',
    cpp: '.cpp',
    csharp: '.cs',
    fsharp: '.fs',
    rust: '.rs',
    objc: '.m',
    swift: '.swift',
    sql: '.sql',
    xml: '.xml',
    markdown: '.md',
    powershell: '.ps1',
    batch: '.bat',
    dockerfile: 'Dockerfile',
    java: '.java'
  };
  return map[lang] || '.txt';
}

function getDefaultCode(lang) {
  if (lang === 'html') return '<!DOCTYPE html>\n<html>\n<head>\n  <meta charset="UTF-8">\n  <title>FriskStudio</title>\n</head>\n<body>\n  <h1>Hello FriskStudio Code!</h1>\n</body>\n</html>';
  if (lang === 'css') return 'body {\n  background: #222;\n  color: #eee;\n}';
  if (lang === 'javascript' || lang === 'nodejs') return 'console.log("Hello FriskStudio Code");';
  if (lang === 'json') return '{\n  "message": "Hello FriskStudio Code"\n}';
  if (lang === 'python') return 'print("Hello FriskStudio Code")';
  if (lang === 'php') return '<?php\necho "Hello FriskStudio Code";\n';
  if (lang === 'ruby') return 'puts "Hello FriskStudio Code"';
  if (lang === 'perl') return 'print "Hello FriskStudio Code\\n";';
  if (lang === 'go') return 'package main\nimport "fmt"\nfunc main(){\n  fmt.Println("Hello FriskStudio Code")\n}';
  if (lang === 'c') return '#include <stdio.h>\nint main(){\n  printf("Hello FriskStudio Code\\n");\n  return 0;\n}';
  if (lang === 'cpp') return '#include <iostream>\nint main(){\n  std::cout << "Hello FriskStudio Code\\n";\n}';
  if (lang === 'csharp') return 'using System;\nclass Program {\n  static void Main(){\n    Console.WriteLine("Hello FriskStudio Code");\n  }\n}';
  if (lang === 'fsharp') return 'printfn "Hello FriskStudio Code"';
  if (lang === 'rust') return 'fn main(){\n  println!("Hello FriskStudio Code");\n}';
  if (lang === 'objc') return '@import Foundation;\nint main(){\n  NSLog(@"Hello FriskStudio Code");\n  return 0;\n}';
  if (lang === 'swift') return 'print("Hello FriskStudio Code")';
  if (lang === 'sql') return 'SELECT "Hello FriskStudio Code" AS message;';
  if (lang === 'xml') return '<root>\n  <message>Hello FriskStudio Code</message>\n</root>';
  if (lang === 'markdown') return '# Hello FriskStudio Code';
  if (lang === 'powershell') return 'Write-Host "Hello FriskStudio Code"';
  if (lang === 'batch') return '@echo off\necho Hello FriskStudio Code';
  if (lang === 'dockerfile') return 'FROM alpine:latest\nCMD echo "Hello FriskStudio Code"';
  if (lang === 'java') return 'class Main {\n  public static void main(String[] args){\n    System.out.println("Hello FriskStudio Code");\n  }\n}';
  return '';
}

function updatePreview() {
  if (!editor) return;
  const code = editor.getValue();
  const doc = previewFrame.contentWindow.document;
  doc.open();
  doc.write(code);
  doc.close();
}

/* 設定モーダル */
settingsBtn.addEventListener('click', () => {
  settingsModal.style.display = 'flex';
});
function closeSettings() {
  settingsModal.style.display = 'none';
}

/* 設定反映 */
document.getElementById('themeDark').addEventListener('change', () => {
  if (document.getElementById('themeDark').checked) {
    currentTheme = 'dark';
    document.body.classList.remove('light');
    if (editor && window.monacoReady) monaco.editor.setTheme('vs-dark');
  }
});
document.getElementById('themeLight').addEventListener('change', () => {
  if (document.getElementById('themeLight').checked) {
    currentTheme = 'light';
    document.body.classList.add('light');
    if (editor && window.monacoReady) monaco.editor.setTheme('vs');
  }
});
document.getElementById('overwriteToggle').addEventListener('change', e => {
  overwriteEnabled = e.target.checked;
  // ここで将来「読み込んだファイルを上書きするかどうか」に使う
});
document.getElementById('previewAuto').addEventListener('change', () => {
  if (document.getElementById('previewAuto').checked) {
    previewMode = 'auto';
    if (currentLang === 'html') updatePreview();
  }
});
document.getElementById('previewManual').addEventListener('change', () => {
  if (document.getElementById('previewManual').checked) {
    previewMode = 'manual';
  }
});

/* ダウンロード */
downloadBtn.addEventListener('click', () => {
  if (!editor) return;
  const blob = new Blob([editor.getValue()], { type: 'text/plain' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'code' + getExtLabel(currentLang);
  a.click();
  URL.revokeObjectURL(a.href);
});
</script>

</body>
</html>
